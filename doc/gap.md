# `README.md`と現状実装のギャップ分析と今後の実装プラン

## 1. `README.md`とのギャップ分析

`README.md`で描かれている理想的なアーキテクチャと、現在の実装状況を比較した結果、以下の主要なギャップが確認された。

| 機能要素 | `README.md` (理想) | 現状の実装 | ギャップ |
| :--- | :--- | :--- | :--- |
| **1. 脚本生成** | プレーンテキスト形式で脚本を出力。 | `script_agent`が**プレーンテキスト形式**で出力。 | **ギャップなし** |
| **2. 音声生成** | テキストをモノラル音声に変換。 | `tts_agent`が**モノラル音声**を生成。 | **ギャップなし** |
| **3. 脚本の構造化** | 専門エージェントが音声とテキストを分析し、**タイムスタンプ付きJSON**を生成。 | **未実装** | **機能自体が欠落** |
| **4. 空間演出プランニング** | 専門エージェントが構造化脚本と音声を分析し、**JSONキーフレーム**を生成。 | **未実装** | **機能自体が欠落** |
| **5. ASMR化 (バイノーラル)** | 専門エージェントが音声とプランを元に**バイノーラル音声**を生成。 | **未実装** | **機能自体が欠落** |
| **6. 依存ライブラリ** | `spaudiopy`, `pedalboard` 等を使用。 | `requirements.txt` に記載済み | **ギャップなし** |
| **7. 全体ワークフロー** | 5つのエージェントが連携するマルチエージェントシステム。 | 2つのエージェント(`script` -> `tts`)を直列に実行するのみ。 | **アーキテクチャの単純化** |

**結論として、現状は「テキストでの脚本生成」と「モノラル音声の合成」という基本的な機能のみが実装されており、`README.md`の根幹をなす「AIによる動的な空間演出」と「バイノーラル音声化」の機能が完全に欠落している状態です。**

---

## 2. 今後の実装プラン

上記のギャップを解消し、`README.md`で定義されたアプリケーションを完成させるための実装プランを以下に提案します。

### Step 1: 依存関係の追加 (完了済)

ASMR化処理に必須の音声処理ライブラリをプロジェクトに追加します。

-   **タスク**: `requirements.txt` に `spaudiopy`, `pedalboard`, `numpy`, `soundfile` を追加し、インストールする。

### Step 2: 【新規】JSON化エージェントの作成 (`jsonize_agent.py`)

脚本(テキスト)と音声(WAV)を分析し、タイムスタンプ付きの構造化JSONを生成するエージェントを新規作成します。

-   **ファイル**: `asmr_gen_adk/agents/jsonize_agent.py` を新規作成します。
-   **入力**: `script_text`, `wav_path`
-   **処理**: Gemini 2.5 Pro (Multi-modal) を利用し、音声とテキストを照合して、話者とタイムスタンプを含むJSONを出力するプロンプトを設計します。
-   **出力**: `timed_script_json`

### Step 3: 【新規】空間演出プラン生成エージェントの作成 (`spatial_plan_agent.py`)

空間演出プランを生成するエージェントを新規に作成します。

-   **ファイル**: `asmr_gen_adk/agents/spatial_plan_agent.py` を新規作成します。
-   **入力**: `timed_script_json`, `wav_path`
-   **処理**: Gemini 2.5 Pro (Multi-modal) を利用し、構造化された脚本と音声のタイミングを基に、`README.md`記載のキーフレーム形式で空間演出プランを出力するプロンプトを設計します。
-   **出力**: `spatial_plan_json`

### Step 4: 【新規】ASMR化エージェント（ツール）の作成 (`binaural_renderer.py`)

モノラル音声をバイノーラル化する音声処理ツールと、それを呼び出すエージェントを作成します。

-   **ファイル**: `asmr_gen_adk/tools/binaural_renderer.py` を新規作成し、音声処理ロジックを実装します。
    -   **入力**: `wav_path`, `spatial_plan_json`
    -   **処理**: `spaudiopy` と `pedalboard` を利用して、空間演出プランに基づきバイノーラル音声をレンダリングします。
    -   **出力**: `binaural_output_path`
-   **ファイル**: `asmr_gen_adk/agents/asmr_agent.py` を新規作成し、上記ツールを呼び出す`LlmAgent`を定義します。

### Step 5: 全体ワークフローの再構築 (`agent.py`)

`README.md`のフロー図に沿ったワークフローに再構築します。

-   **タスク**: `SequentialAgent` を使用して、以下の5エージェントからなる直列処理を実装します。
    1.  `script_agent`
    2.  `tts_agent`
    3.  `jsonize_agent`
    4.  `spatial_plan_agent`
    5.  `asmr_agent`
