# 高品質で臨場感のあるASMR音声作成のための改善計画 (asmr_improvement_plan.md)

## 1. エグゼクティブサマリー

本ドキュメントは、ASMR-GENプロジェクトの現状の音声生成フロー（参考Doc参照）を分析し、「1. 睡眠導入」および「2. 恋人/擬似恋愛用の囁きボイス」の品質と臨場感を飛躍的に向上させるための具体的な改善計画を提案する。

主な戦略は、AIエージェント（`spatial_plan_agent`）による空間プランニングの精度向上と、デジタル信号処理（DSP）エンジン（`BinauralRenderer`）の機能強化による音響リアリティの追求である。

### 1.1. 現状の課題分析

参考Docおよび現状の実装から、以下の主要な課題が特定された。

1.  **リバーブ（残響）が過剰かつ不適切**: `BinauralRenderer` のリバーブ設定が固定値（`room_size=0.6`）であり、ASMRで求められる親密な空間（寝室など）に対して広すぎる。
2.  **音源移動の不自然さ**: `spatial_plan_agent` が物理的制約を無視した移動（急激な速度変化や瞬間移動）を計画する可能性がある。また、キーフレーム間の線形補間が滑らかさに欠ける場合がある。
3.  **近距離表現（親密感）のリアリティ不足**: 距離の変化が音量減衰のみで表現されており、耳元に近づいた際の音響的な変化（近接効果）が再現されていない。これは囁きボイスにおいて致命的である。

### 1.2. 目標とする品質

*   **親密感 (Intimacy)**: 耳元での囁きがリアルに再現され、息遣いや体温が感じられるような実在感。
*   **臨場感 (Immersiveness)**: 音源の定位が明確で、移動が滑らかであり、空間の響きがシチュエーションと一致していること。
*   **快適性 (Comfort)**: ノイズ、過剰なリバーブ、不快な歯擦音（しさつおん）がないこと。特に睡眠導入において重要。

## 2. 改善エリア1: `spatial_plan_agent` の高度化

LLMによる空間プランニングの精度と表現力を向上させ、自然な動きと適切な空間表現を実現する。

### 2.1. プロンプトエンジニアリングの強化

`spatial_plan_agent.py` のプロンプトを改善し、ASMR特有の要件を的確に反映させる。

*   **物理的制約の導入**:
    *   「音源の最大移動速度は秒速0.5m以内に抑えること」「瞬間移動を避け、滑らかな軌跡を描くこと」といった物理的制約を明示し、不自然なキーフレーム生成を抑制する。
*   **距離とリバーブの連動指示**:
    *   `distance` と `reverb_mix` の関係性を具体的に指示する。
    *   例: 「`distance` が 0.3m 未満（耳元）の場合、`reverb_mix` は 0.05 以下に設定し、ドライ音を優先すること。」
*   **用途特化型Few-shot Examples**:
    *   「睡眠導入用」（ゆっくりとした左右移動、一定の距離感）と「恋愛ボイス用」（ダイナミックな接近、耳元での滞在時間が長い）それぞれに最適化された理想的な脚本と空間プラン（JSON）のペアをプロンプトに含め、出力品質を安定させる。

### 2.2. マルチモーダル分析の活用強化

LLMの音声分析能力（マルチモーダル機能）を活用し、音声の抑揚に基づいた空間演出を行う。

*   **声質と距離の連動**:
    *   「入力音声の音量とトーン（囁き声か地声か）を分析せよ。特に静かで優しい囁きの部分では、`distance` を短く（近づけ）、通常の発話ではわずかに離すようにプランニングせよ」という指示を追加する。これにより、感情表現と連動した没入感が生まれる。

### 2.3. 空間プランパラメータの拡張（中長期）

シーンに応じた空間の「質」をエージェントが設計できるように、`spatial_plan_json` の拡張を検討する。

```json
// 拡張案
{
  "time": float,
  // ... azimuth, elevation, distance ...
  "reverb_mix": float,
  "reverb_params": { // シーンに応じたリバーブの質感設定を動的に変更
    "room_size": float,
    "damping": float
  }
}
```

## 3. 改善エリア2: `BinauralRenderer` の機能強化（DSPとリアリズム）

音声処理エンジンを高度化し、特にリバーブと近距離表現の品質を向上させる。

### 3.1. リバーブ処理の最適化

「リバーブが過剰」という課題を解決する。

*   **[即時対策] デフォルトパラメータの見直し**:
    *   `_apply_dynamic_reverb` 内の `pedalboard.Reverb` パラメータを、狭くデッドな（残響の少ない）空間に変更する。
    *   現状: `room_size=0.6`, `damping=0.5`
    *   変更案: `room_size=0.2` (狭い部屋), `damping=0.8` (高域の残響を吸収し、吸音性が高い)。
*   **[中長期対策] 畳み込みリバーブの導入検討**:
    *   アルゴリズミックリバーブから、実際の空間（寝室など）のインパルス応答（IR）を用いる畳み込みリバーブへ移行することで、飛躍的にリアルな空間表現が可能になる。

### 3.2. 近接効果（Proximity Effect）の導入【最重要】

耳元での囁きのリアリティを劇的に向上させるため、近接効果をシミュレートする。

*   **原理**: 音源が耳に近づくほど低周波数が強調される音響現象。これがASMRの「ゾクゾク感」に大きく寄与する。
*   **実装案**:
    *   `_render_binaural_dynamic_crossfade` 関数内で、現在の距離 (`dist`) に応じて動的にイコライザー（EQ）を適用する処理を追加する。
    *   `dist` が短い場合（例: 0.3m以下）、ローシェルフフィルターを用いて低域（例: 200Hz以下）を自然にブーストする。

### 3.3. 空気吸収（Air Absorption）のシミュレーション

距離感の表現をよりリアルにするため、空気による高周波の減衰をシミュレートする。

*   **原理**: 距離が遠くなるほど高周波が減衰し、音がこもって聞こえる現象。
*   **実装案**: 距離 (`dist`) に応じてローパスフィルターまたはハイシェルフフィルターを用いて高域を動的に減衰させる。

### 3.4. 音像移動の平滑化

*   **現状**: キーフレーム間は線形補間（`scipy.interpolate.interp1d`）で行われており、移動の開始・停止時に不自然さが出ることがある。
*   **改善案**: 線形補間から3次スプライン補間（例: `kind='cubic'`）などに変更し、より滑らかな速度変化を実現する。

## 4. 改善エリア3: ポストプロダクションと品質管理

最終的な出力の聴感を改善し、快適性を高める。

### 4.1. ディエッサー（De-esser）の導入

*   囁き声では歯擦音（サ行など）が強調され、耳障りになりやすい。特に睡眠導入用途では問題となる。
*   `BinauralRenderer` の前処理または後処理段階でディエッサーを導入し、不快な高周波ノイズを適切に減衰させる。

### 4.2. マスタリング処理

*   **ラウドネスノーマライゼーション**:
    *   生成された音声の聴感上の音量が一定になるように調整する。ピーク値ではなくラウドネス値（LUFS）を基準に調整する（例: ターゲットを -18 LUFS などに設定）。
*   **最終EQ調整**:
    *   全体の周波数バランスを調整。高域（例: 10kHz以上）をわずかに強調（エキサイター効果）し、息遣いの空気感を際立たせる。

## 5. 評価戦略とロードマップ

### 5.1. 評価戦略

*   **主観評価（MOS評価）**: 改善前後の音声を比較試聴（A/Bテスト）し、「定位の自然さ」「距離感のリアルさ（親密感）」「没入感」「心地よさ」の各項目について5段階評価を実施する。
*   **客観評価**: 空間プランが物理的制約（移動速度ガイドラインなど）を満たしているかを自動チェックする。

### 5.2. 実施ロードマップ

| フェーズ | 優先度 | 主な取り組み項目 | 期待される成果 |
| :--- | :--- | :--- | :--- |
| **Phase 1** | 高 | 3.1. リバーブパラメータ見直し<br>2.1. プロンプト強化（物理制約・連動指示）<br>3.4. 音像移動の平滑化（スプライン補間） | 過剰なリバーブと不自然な動きが解消され、基本的な没入感が向上する。 |
| **Phase 2** | 中〜高 | 3.2. 近接効果の導入【最重要】<br>4.1. ディエッサー導入<br>4.2. マスタリング処理導入<br>2.2. マルチモーダル分析の活用 | 耳元での囁きのリアリティ（親密感）が劇的に向上し、音声の快適性が高まる。 |
| **Phase 3** | 中 | 3.3. 空気吸収シミュレーション<br>3.1. 畳み込みリバーブ導入検討<br>2.3. 空間プランパラメータ拡張 | より高度でリアルな音響空間シチュエーションに対応可能になる。 |
